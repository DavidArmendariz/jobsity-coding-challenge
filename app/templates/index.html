{% extends "base.html" %} {% block styles %}
<style>
  div.new_messages {
    background-color: lightcyan;
    width: 700px;
    height: 400px;
    overflow: scroll;
  }
</style>
{% endblock %} {% block content %}
<h1>Welcome to the chatroom, {{ current_user.username }}!</h1>
<div class="new_messages">
  {% for message in messages %}
  <p><b>{{ message.user.username }}:</b> {{ message.body }}</p>
  {% endfor %}
</div>

<form action="" method="POST">
  <input type="text" class="message" placeholder="Message" />
  <input type="submit" />
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
<script type="text/javascript">
  const socket = io.connect("http://" + document.domain + ":" + location.port);

  socket.on("connect", function () {
    const form = $("form").on("submit", function (event) {
      event.preventDefault();
      const message = $("input.message").val();
      socket.emit("receive message", {
        message,
      });
      $("input.message").val("").focus();
    });
  });
  socket.on("my response", function (message) {
    console.log(message);
    if (typeof message.username !== "undefined") {
      $("div.new_messages").append(
        "<p><b>" + message.username + ": </b>" + message.body + "</p>"
      );
    }
  });
</script>

{% endblock %}
